---
name: Pod Autoscalers (HPA) - Working
description: |
  Demonstrates Horizontal Pod Autoscaling based on CPU utilization for a simple HTTP echo app.
  The HPA targets average CPU utilization of 50% across pods (min=1, max=5).
source:
  - https://medium.com/@muppedaanvesh/a-hands-on-guide-to-kubernetes-horizontal-vertical-pod-autoscalers-%EF%B8%8F-58903382ef71
tags: [hpa, autoscaling, cpu, metrics, ingress, demo]
objectives:
  - Deploy a CPU-requested application and expose it via HTTPS Ingress
  - Configure an HPA (autoscaling/v2) to scale on average CPU utilization
  - Generate load and observe replicas scale up and down
prerequisites:
  - NGINX Ingress Controller with TLS secret "demo-tls" (provided by this repo)
  - Metrics Server available:
      - minikube: minikube addons enable metrics-server
      - OrbStack: metrics-server is typically present; if not, install it before running this demo
notes: |-
  Generate load (busybox):
    kubectl run -n "$KEMO_NS" -it loadgen --rm --image=busybox:1.36 -- /bin/sh -c 'while true; do wget -qO- http://pod-autoscalers.$KEMO_NS.svc.cluster.local >/dev/null; done'

  Watch scaling:
    kubectl get hpa -w -n "$KEMO_NS"
    kubectl get pods -w -n "$KEMO_NS"

  Access the app:
    https://pod-autoscalers-good.k8s.orb.local/
